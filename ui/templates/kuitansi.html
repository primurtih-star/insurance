<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuitansi Digital - White Peace</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&family=Courier+Prime&display=swap" rel="stylesheet">

    <style>
        /* =========================================================
           1. GLOBAL THEME & TYPOGRAPHY
           ========================================================= */
        :root {
            --c-bg-app: #fdfbf7;
            --c-emerald: #10b981;
            --c-emerald-dark: #059669;
            --c-emerald-soft: #ecfdf5;
            --c-gold: #f59e0b;
            --c-border-soft: #e5e7eb;
            --c-text-main: #111827;
            --c-text-muted: #6b7280;
        }

        body {
            background-color: var(--c-bg-app);
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: #374151;
            overflow-x: hidden;
        }

        .font-playfair {
            font-family: "Playfair Display", serif;
        }

        .font-mono-custom {
            font-family: "Courier Prime", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        /* =========================================================
           2. GLASS SIDEBAR & NAVIGATION
           ========================================================= */
        .glass-sidebar {
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 8px 0 30px rgba(15, 23, 42, 0.08);
        }

        .nav-item-custom {
            transition: all 0.25s ease;
            border-radius: 0.9rem;
        }

        .nav-item-custom:hover {
            background-color: #f9fafb;
            color: var(--c-emerald);
            transform: translateX(2px);
        }

        .nav-item-active {
            background-color: var(--c-emerald-soft);
            color: var(--c-emerald-dark);
        }

        /* =========================================================
           3. INPUT & BUTTON DESIGN
           ========================================================= */

        .custom-input {
            transition: all 0.25s ease;
            background-color: #ffffff;
            border: 1px solid var(--c-border-soft);
        }

        .custom-input:focus {
            border-color: var(--c-emerald);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            outline: none;
        }

        .custom-textarea {
            resize: none;
            min-height: 96px;
        }

        .btn-emerald {
            background-color: var(--c-emerald);
            color: #ffffff;
            transition: all 0.25s ease;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.35);
        }

        .btn-emerald:hover {
            background-color: var(--c-emerald-dark);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.5);
        }

        .btn-secondary {
            background-color: #ffffff;
            color: #4b5563;
            border: 1px solid var(--c-border-soft);
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }

        /* =========================================================
           4. RECEIPT PAPER AESTHETIC
           ========================================================= */

        .receipt-paper {
            background-color: #ffffff;
            background-image: radial-gradient(#f3f4f6 1px, transparent 1px);
            background-size: 18px 18px;
            box-shadow: 0 18px 40px -10px rgba(15, 23, 42, 0.35);
            position: relative;
            border-radius: 0.5rem;
        }

        .receipt-paper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(to right, var(--c-emerald), var(--c-gold));
            border-radius: 4px 4px 0 0;
        }

        .amount-ribbon {
            background: linear-gradient(135deg, #111827, #1f2937);
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.3);
        }

        /* =========================================================
           5. BACKGROUND CANVAS (SOFT PARTICLES)
           ========================================================= */

        #bg-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
        }

        /* =========================================================
           6. PRINT MODE
           ========================================================= */

        @media print {
            body * {
                visibility: hidden;
            }

            #receipt-preview-area,
            #receipt-preview-area * {
                visibility: visible;
            }

            #receipt-preview-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 16mm;
                box-shadow: none;
                background: #ffffff;
                border-radius: 0;
            }

            .no-print {
                display: none !important;
            }

            #bg-canvas {
                display: none;
            }
        }

        /* =========================================================
           7. CUSTOM SCROLLBAR
           ========================================================= */

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* =========================================================
           8. RESPONSIVE TWEAKS
           ========================================================= */

        @media (max-width: 1024px) {
            .sidebar-hidden-mobile {
                display: none;
            }
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- =========================================================
         BACKGROUND CANVAS (EMERALD & GOLD PARTICLES)
         ========================================================= -->
    <canvas id="bg-canvas"></canvas>

    <!-- =========================================================
         SIDEBAR NAVIGATION
         ========================================================= -->
    <aside class="glass-sidebar w-20 lg:w-64 flex-shrink-0 flex flex-col justify-between h-full z-20 transition-all duration-300">
        <div>
            <!-- Brand -->
            <div class="h-20 flex items-center justify-center lg:justify-start lg:px-6 border-b border-gray-100">
                <div class="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-200">
                    <i class="fa-solid fa-file-invoice"></i>
                </div>
                <div class="hidden lg:flex flex-col ml-3">
                    <span class="font-playfair font-bold text-xl text-gray-800 leading-tight">KuitansiKu</span>
                    <span class="text-[11px] uppercase tracking-wide text-gray-400 font-semibold">Digital Receipt Studio</span>
                </div>
            </div>

            <!-- Menu -->
            <nav class="mt-8 px-3 lg:px-4 space-y-3">
                <a href="#" class="nav-item-custom nav-item-active flex items-center px-4 py-3 text-sm font-medium">
                    <i class="fa-solid fa-pen-nib w-6 text-center"></i>
                    <span class="ml-3 hidden lg:block">Buat Kuitansi</span>
                </a>

                <a href="#" class="nav-item-custom flex items-center px-4 py-3 text-sm text-gray-500">
                    <i class="fa-solid fa-clock-rotate-left w-6 text-center"></i>
                    <span class="ml-3 hidden lg:block">Riwayat</span>
                </a>

                <a href="#" class="nav-item-custom flex items-center px-4 py-3 text-sm text-gray-500">
                    <i class="fa-solid fa-address-book w-6 text-center"></i>
                    <span class="ml-3 hidden lg:block">Kontak Favorit</span>
                </a>
            </nav>
        </div>

        <!-- Bottom Menu -->
        <div class="p-3 lg:p-4 border-t border-gray-100">
            <a href="#" class="nav-item-custom flex items-center px-4 py-3 text-sm text-gray-500">
                <i class="fa-solid fa-gear w-6 text-center"></i>
                <span class="ml-3 hidden lg:block">Pengaturan</span>
            </a>
        </div>
    </aside>

    <!-- =========================================================
         MAIN AREA
         ========================================================= -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative z-10">

        <!-- Header (Mobile) -->
        <header class="h-16 glass-sidebar flex lg:hidden items-center justify-between px-5 border-b border-gray-100">
            <span class="font-playfair font-bold text-lg text-gray-800">KuitansiKu</span>
            <button class="text-gray-500 no-print">
                <i class="fa-solid fa-bars"></i>
            </button>
        </header>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4 lg:p-8 flex flex-col lg:flex-row gap-6">

            <!-- =================================================
                 LEFT SIDE: FORM
                 ================================================= -->
            <section class="w-full lg:w-5/12 space-y-6">
                <div class="bg-white rounded-2xl p-6 lg:p-8 shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800">Detail Kuitansi</h2>
                            <p class="text-xs text-gray-500 mt-1">Isi data di bawah untuk menghasilkan kuitansi resmi.</p>
                        </div>
                        <span class="text-[11px] font-semibold px-2 py-1 bg-emerald-50 text-emerald-600 rounded-md border border-emerald-100">
                            <i class="fa-solid fa-cloud-arrow-up mr-1"></i> Auto-Save
                        </span>
                    </div>

                    <form id="receiptForm" class="space-y-5" autocomplete="off">
                        <!-- Nomor & Tanggal -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1.5">No. Kuitansi</label>
                                <input type="text" id="noKuitansi" class="w-full px-4 py-3.5 rounded-xl custom-input text-gray-700 text-sm" placeholder="K-2025/001" value="K-2025/001">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1.5">Tanggal</label>
                                <input type="date" id="tanggal" class="w-full px-4 py-3.5 rounded-xl custom-input text-gray-700 text-sm">
                            </div>
                        </div>

                        <!-- Terima dari -->
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1.5">Sudah Terima Dari</label>
                            <input type="text" id="terimaDari" class="w-full px-4 py-3.5 rounded-xl custom-input text-gray-700 text-sm" placeholder="Nama pembayar / perusahaan">
                        </div>

                        <!-- Nominal -->
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1.5">Nominal (Rupiah)</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-medium text-sm">Rp</span>
                                <input type="text" id="nominal" class="w-full pl-10 pr-4 py-3.5 rounded-xl custom-input text-gray-800 font-semibold text-lg" placeholder="0">
                            </div>
                            <p class="mt-1.5 text-xs text-emerald-700 italic" id="terbilangPreview">Nol Rupiah</p>
                        </div>

                        <!-- Untuk pembayaran -->
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1.5">Untuk Pembayaran</label>
                            <textarea id="untukPembayaran" rows="3" class="w-full px-4 py-3.5 rounded-xl custom-input custom-textarea text-gray-700 text-sm" placeholder="Contoh: Pembayaran premi asuransi kesehatan periode Januari 2025."></textarea>
                        </div>

                        <!-- Penerima -->
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1.5">Penerima (Issuer)</label>
                            <input type="text" id="penerima" class="w-full px-4 py-3.5 rounded-xl custom-input text-gray-700 text-sm" placeholder="Nama Anda / nama perusahaan">
                        </div>

                        <!-- Optional Footer Actions -->
                        <div class="flex flex-wrap gap-3 pt-3 border-t border-dashed border-gray-200 mt-2">
                            <button type="button" id="btnReset" class="btn-secondary px-4 py-2.5 rounded-xl text-xs font-medium no-print">
                                <i class="fa-solid fa-rotate-left mr-1"></i> Reset Form
                            </button>
                            <button type="button" id="btnSample" class="btn-secondary px-4 py-2.5 rounded-xl text-xs font-medium no-print">
                                <i class="fa-solid fa-magic mr-1"></i> Isi Contoh
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- =================================================
                 RIGHT SIDE: RECEIPT PREVIEW
                 ================================================= -->
            <section class="w-full lg:w-7/12 flex flex-col">
                <!-- Actions -->
                <div class="flex justify-between items-center mb-3 px-1">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-700">Preview Kuitansi</h2>
                        <p class="text-xs text-gray-500">Tampilan akhir dokumen yang akan dicetak atau disimpan.</p>
                    </div>
                    <div class="flex space-x-3 no-print">
                        <button id="btnCopy" class="btn-secondary px-4 py-2.5 rounded-xl text-xs font-medium flex items-center">
                            <i class="fa-solid fa-copy mr-2"></i> Salin Data
                        </button>
                        <button onclick="window.print()" class="btn-emerald px-5 py-2.5 rounded-xl font-medium flex items-center text-sm">
                            <i class="fa-solid fa-print mr-2"></i> Cetak / PDF
                        </button>
                    </div>
                </div>

                <!-- Canvas -->
                <div class="flex-1 flex items-start justify-center p-4 lg:p-8 bg-gray-100/50 rounded-3xl border border-gray-200 overflow-auto">
                    <!-- Actual Receipt -->
                    <div id="receipt-preview-area" class="receipt-paper w-full max-w-2xl p-8 lg:p-10 min-h-[480px] flex flex-col justify-between">
                        
                        <!-- HEADER -->
                        <header class="flex justify-between items-start border-b-2 border-dashed border-gray-200 pb-5 mb-6">
                            <div>
                                <h1 class="text-3xl font-playfair font-bold text-gray-800 tracking-[0.14em]">KUITANSI</h1>
                                <p class="text-gray-500 text-xs mt-1">Bukti penerimaan pembayaran yang sah.</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[11px] text-gray-400 uppercase tracking-wide">No. Referensi</p>
                                <p class="text-lg font-mono-custom font-bold text-emerald-600" id="prev-no">K-2025/001</p>
                                <p class="text-xs text-gray-500 mt-1" id="prev-date">-</p>
                            </div>
                        </header>

                        <!-- BODY -->
                        <main class="flex-1 space-y-6">

                            <div class="flex flex-col sm:flex-row">
                                <div class="w-32 text-gray-500 text-xs sm:text-sm py-1">Sudah Terima Dari</div>
                                <div class="flex-1 border-b border-gray-300 py-1 font-medium text-gray-800" id="prev-from">-</div>
                            </div>

                            <div class="flex flex-col sm:flex-row">
                                <div class="w-32 text-gray-500 text-xs sm:text-sm py-1">Uang Sejumlah</div>
                                <div class="flex-1 bg-emerald-50/60 p-3 rounded-lg border border-emerald-100">
                                    <p class="font-bold italic text-emerald-700 capitalize leading-relaxed text-sm sm:text-base" id="prev-terbilang">Nol Rupiah</p>
                                </div>
                            </div>

                            <div class="flex flex-col sm:flex-row">
                                <div class="w-32 text-gray-500 text-xs sm:text-sm py-1">Untuk Pembayaran</div>
                                <div class="flex-1 border-b border-gray-300 py-1 text-gray-800 leading-relaxed text-sm" id="prev-desc">-</div>
                            </div>
                        </main>

                        <!-- FOOTER -->
                        <footer class="mt-10 flex flex-col sm:flex-row justify-between items-end gap-8">
                            <!-- Amount -->
                            <div class="amount-ribbon text-white px-6 py-4 rounded-xl transform -rotate-1">
                                <p class="text-[10px] text-gray-400 mb-1 font-mono-custom">JUMLAH (IDR)</p>
                                <p class="text-2xl font-bold tracking-widest font-mono-custom" id="prev-amount">Rp 0</p>
                            </div>

                            <!-- Signature -->
                            <div class="text-center min-w-[150px]">
                                <p class="text-xs text-gray-500 mb-16">Penerima,</p>
                                <p class="font-semibold text-gray-800 border-b border-gray-300 pb-1 px-4 inline-block" id="prev-issuer">( Nama Penerima )</p>
                            </div>
                        </footer>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- =========================================================
         JAVASCRIPT SECTION
         ========================================================= -->
    <script>
        // =========================================================
        // 1. BACKGROUND PARTICLE ANIMATION
        // =========================================================
        const canvas = document.getElementById("bg-canvas");
        const ctx = canvas.getContext("2d");
        let width, height, particles = [];

        function resizeCanvas() {
            width  = canvas.width  = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initParticles();
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 3 + 1;
                this.speedX = (Math.random() * 0.4) - 0.2;
                this.speedY = (Math.random() * 0.4) - 0.2;

                const colors = [
                    "rgba(16,185,129,0.15)",
                    "rgba(16,185,129,0.06)",
                    "rgba(245,158,11,0.1)"
                ];
                this.color = colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (this.x > width)  this.x = 0;
                if (this.x < 0)      this.x = width;
                if (this.y > height) this.y = 0;
                if (this.y < 0)      this.y = height;
            }

            draw() {
                ctx.beginPath();
                ctx.fillStyle = this.color;
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            const count = Math.floor(width * 0.07); // responsif terhadap lebar layar
            for (let i = 0; i < count; i++) {
                particles.push(new Particle());
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }

        animateParticles();

        // =========================================================
        // 2. FUNGSI TERBILANG (INDONESIA)
        // =========================================================
        function terbilang(nilai) {
            nilai = Math.floor(Math.abs(nilai)); // pastikan integer positif

            const huruf = ["", "Satu", "Dua", "Tiga", "Empat", "Lima", "Enam",
                           "Tujuh", "Delapan", "Sembilan", "Sepuluh", "Sebelas"];

            if (nilai < 12) {
                return huruf[nilai] || "Nol";
            } else if (nilai < 20) {
                return terbilang(nilai - 10) + " Belas";
            } else if (nilai < 100) {
                return terbilang(Math.floor(nilai / 10)) + " Puluh " + terbilang(nilai % 10);
            } else if (nilai < 200) {
                return "Seratus " + terbilang(nilai - 100);
            } else if (nilai < 1000) {
                return terbilang(Math.floor(nilai / 100)) + " Ratus " + terbilang(nilai % 100);
            } else if (nilai < 2000) {
                return "Seribu " + terbilang(nilai - 1000);
            } else if (nilai < 1000000) {
                return terbilang(Math.floor(nilai / 1000)) + " Ribu " + terbilang(nilai % 1000);
            } else if (nilai < 1000000000) {
                return terbilang(Math.floor(nilai / 1000000)) + " Juta " + terbilang(nilai % 1000000);
            } else if (nilai < 1000000000000) {
                return terbilang(Math.floor(nilai / 1000000000)) + " Miliar " + terbilang(nilai % 1000000000);
            } else {
                return "Jumlah Terlalu Besar";
            }
        }

        // =========================================================
        // 3. PREVIEW LOGIC
        // =========================================================
        const inputNo      = document.getElementById("noKuitansi");
        const inputTanggal = document.getElementById("tanggal");
        const inputDari    = document.getElementById("terimaDari");
        const inputNominal = document.getElementById("nominal");
        const inputDesc    = document.getElementById("untukPembayaran");
        const inputIssuer  = document.getElementById("penerima");

        const prevNo        = document.getElementById("prev-no");
        const prevDate      = document.getElementById("prev-date");
        const prevFrom      = document.getElementById("prev-from");
        const prevTerbilang = document.getElementById("prev-terbilang");
        const prevDesc      = document.getElementById("prev-desc");
        const prevAmount    = document.getElementById("prev-amount");
        const prevIssuer    = document.getElementById("prev-issuer");
        const terbilangPreview = document.getElementById("terbilangPreview");

        function formatNumberToRupiah(value) {
            const numeric = parseInt(String(value).replace(/\D/g, ""), 10);
            if (isNaN(numeric) || numeric === 0) return "";
            return numeric.toLocaleString("id-ID");
        }

        function updateReceiptPreview() {
            const noVal   = inputNo.value.trim() || "-";
            const fromVal = inputDari.value.trim() || "-";
            const descVal = inputDesc.value.trim() || "-";
            const issuerVal = inputIssuer.value.trim() || "( Nama Penerima )";

            // Tanggal
            let dateText = "-";
            if (inputTanggal.value) {
                const ops = { year: "numeric", month: "long", day: "numeric" };
                dateText = new Date(inputTanggal.value).toLocaleDateString("id-ID", ops);
            }

            // Nominal
            const numericNominal = parseInt(String(inputNominal.value).replace(/\D/g, ""), 10) || 0;
            const nominalFormatted = "Rp " + numericNominal.toLocaleString("id-ID");

            const terbilangText = terbilang(numericNominal).trim() + " Rupiah";

            // Apply to preview
            prevNo.textContent        = noVal;
            prevDate.textContent      = dateText;
            prevFrom.textContent      = fromVal;
            prevDesc.textContent      = descVal;
            prevIssuer.textContent    = issuerVal;
            prevAmount.textContent    = nominalFormatted;
            prevTerbilang.textContent = terbilangText;
            terbilangPreview.textContent = terbilangText;
        }

        // =========================================================
        // 4. INPUT EVENT BINDING
        // =========================================================
        function handleNominalInput() {
            const formatted = formatNumberToRupiah(inputNominal.value);
            inputNominal.value = formatted || "";
            updateReceiptPreview();
            saveState();
        }

        [inputNo, inputTanggal, inputDari, inputDesc, inputIssuer].forEach(el => {
            el.addEventListener("input", () => {
                updateReceiptPreview();
                saveState();
            });
        });

        inputNominal.addEventListener("input", handleNominalInput);

        // =========================================================
        // 5. SAMPLE DATA & RESET
        // =========================================================
        const btnReset  = document.getElementById("btnReset");
        const btnSample = document.getElementById("btnSample");
        const btnCopy   = document.getElementById("btnCopy");

        function fillSampleData() {
            const today = new Date();
            inputNo.value      = "K-" + today.getFullYear() + "/INV-001";
            inputTanggal.value = today.toISOString().slice(0, 10);
            inputDari.value    = "Budi Santoso";
            inputNominal.value = "1500000";
            handleNominalInput();
            inputDesc.value    = "Pembayaran premi asuransi kesehatan periode Januari 2025.";
            inputIssuer.value  = "PT Sehat Sentosa";

            updateReceiptPreview();
            saveState();
        }

        function resetForm() {
            document.getElementById("receiptForm").reset();
            inputNominal.value = "";
            terbilangPreview.textContent = "Nol Rupiah";
            updateReceiptPreview();
            clearState();
        }

        if (btnSample) btnSample.addEventListener("click", fillSampleData);
        if (btnReset)  btnReset.addEventListener("click", resetForm);

        // Copy basic text (for WA / email)
        if (btnCopy) {
            btnCopy.addEventListener("click", async () => {
                const text = `
KUITANSI PEMBAYARAN
No: ${prevNo.textContent}
Tanggal: ${prevDate.textContent}

Sudah terima dari: ${prevFrom.textContent}
Sejumlah: ${prevAmount.textContent} (${prevTerbilang.textContent})

Untuk pembayaran: ${prevDesc.textContent}
Penerima: ${prevIssuer.textContent}
`.trim();
                try {
                    await navigator.clipboard.writeText(text);
                    btnCopy.textContent = "Tersalin!";
                    setTimeout(() => { btnCopy.innerHTML = '<i class="fa-solid fa-copy mr-2"></i> Salin Data'; }, 1500);
                } catch (err) {
                    alert("Gagal menyalin ke clipboard.");
                }
            });
        }

        // =========================================================
        // 6. LOCAL STORAGE (AUTO SAVE)
        // =========================================================
        const STORAGE_KEY = "kuitansiKuState_v1";

        function saveState() {
            const state = {
                no: inputNo.value,
                tanggal: inputTanggal.value,
                dari: inputDari.value,
                nominal: inputNominal.value,
                desc: inputDesc.value,
                issuer: inputIssuer.value
            };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch (e) {
                console.warn("LocalStorage error:", e);
            }
        }

        function restoreState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) {
                    // Set default date ke hari ini
                    inputTanggal.value = new Date().toISOString().slice(0, 10);
                    updateReceiptPreview();
                    return;
                }
                const state = JSON.parse(raw);
                inputNo.value       = state.no || inputNo.value;
                inputTanggal.value  = state.tanggal || inputTanggal.value;
                inputDari.value     = state.dari || "";
                inputNominal.value  = state.nominal || "";
                inputDesc.value     = state.desc || "";
                inputIssuer.value   = state.issuer || "";
                updateReceiptPreview();
            } catch (e) {
                console.warn("Restore state error:", e);
            }
        }

        function clearState() {
            try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
        }

        // Initial load
        restoreState();
        updateReceiptPreview();
    </script>
</body>
</html>
